\section{CP Model}
\subsection{Decision Variables}
This model utilizes two primary decision variable matrices to construct the tournament schedule and assign home/away teams for each match.

\subsubsection{\text{matches}}
For each period $p \in P$ and week $w \in W$
$$
matches_{p,w}=m \in M
$$
determines that $rb_{m, w}$ is scheduled in week $w$ and period $p$.


\subsubsection{\text{flip\_slot}}  
For each period $p \in P$ and week $w \in W$  
$$  
flip\_slot_{p,w} = a \in \{0, 1\}  
$$  
determines which team is assigned as the home team for the match $(t_1, t_2)$ scheduled in week $w$ and period $p$. Specifically, $a = 0$ means that $t_1$ plays at home while $t_2$ away; on the contrary, $a = 1$ means $t_2$ plays at home and $t_1$ away.


\subsection{Auxiliary Variables}
\subsubsection{\text{home\_games}}  
For each team $t \in T$  
$$  
home\_games_{t} = h \in [0, \dots, N-1]  
$$  
determines the total number of home games assigned to team $t$ throughout the tournament. Its value is derived from the assignments of the decision variables $matches$ and $flip\_slot$.


\subsection{Objective Function}

The model's objective is to minimize  the $\text{max\_imbalance} \in [1, \dots, N-1]$ variable quantifying the maximum absolute disparity between home and away game assignments across all teams. 
The lower bound of 1 is the best possible balance score, since $\text{max\_imbalance}=0$ is not achievable for an odd number of games, $N-1$.
The upper bound of $N-1$ represents the theoretical maximum possible deviation, occurring if a team plays all its games either at home or away.

The value of $\text{max\_imbalance}$ is determined by looking for the minimum integer satisfying the following fairness constraints:
\[ \forall t \in T : \left| 2 \times \text{home\_games}_{t} - (N-1) \right| \leq \text{max\_imbalance} \]
This formulation is derived from the difference between a team's home games and away games: $|\text{home\_games}_t - \text{away\_games}_t|$. Since \\ $\text{home\_games}_{t} + \text{away\_games}_{t} = N-1$ (total games), expressing $\text{away\_games}_t$ as a function of the other quantities and substituting it in the starting expression, yields $2 \times \text{home\_games}_{t} - (N-1)$. 
By enforcing that this score must be less than or equal to $\text{max\_imbalance}$ for every team, we constrain the variable to being grater or equal than the greatest individual team imbalance.

The matchups inside $rb$ have an unbalanced structure: the team with the largest identifier always plays at home, causing all the other teams to also have an imbalanced schedule. To guide the search towards more balanced solutions, we introduce the following constraint:
\[
\forall w \in W : \left| \sum_{p \in P} \text{flip\_slot}_{p, w} - \left\lfloor \frac{|P|}{2} \right\rfloor \right| \leq 1.
\]
This condition balances, within each week, the flip\_slot values, guiding the solver towards assigning home games more equitably, ultimately speeding up the search for an optimal solution.

\subsection{Constraints}
\subsubsection{Core Constraints}
These constraints are strictly necessary for defining a feasible round-robin schedule:
\begin{enumerate}
    \item \textbf{Each match is assigned to a unique period each week:} 
    \[ \forall w \in W : \texttt{all\_different}([\texttt{matches}[p, w] \mid p \in P]) \]
    Ensures that for every week, every match of $rb$ is scheduled to no more than one period and every period is assigned to a single match. 

    \item \textbf{Each team plays at most twice in the same period:} 
\[ \forall p \in P, \forall t \in T : \left| \{ (w, s) \mid w \in W, s \in S, \text{rb}_{\text{matches}_{p, w}, w, s} = t \} \right| \leq 2 \]
Implemented using the \texttt{global\_cardinality} global constraint.

\end{enumerate}

\subsubsection{Channeling Constraints}
\begin{enumerate}
 \item \textbf{Counting home\_games for each team:}
\[ \forall t \in T : \text{home\_games}_{t} = \sum_{p \in P, w \in W, s \in S} \mathbb{I}\left( \text{rb}_{\text{matches}_{p, w}, w, s} = t \land \text{flip\_slot}_{p, w} = s \right) \]
The indicator function $\mathbb{I}(\cdot)$ ensures that 1 is added to the sum if team $t$ is located in slot $s$ and that slot $s$ is designated as the home slot by $\text{flip\_slot}_{p,w}$.
\end{enumerate}


\subsubsection{Implied Constraints}
\begin{enumerate}
   \item \textbf{Each team appears exactly once per week:}  While this is implicitly ensured by the combination of the \texttt{all\_different} constraint on \texttt{matches} and the structure of \texttt{rb}, this constraint helps the solver propagate information earlier and prune the search space more effectively.  It is implemented using the \texttt{global\_cardinality} global constraint:
    \[
     \forall w \in W, \forall t \in T : \left| \{ (p, s) \mid p \in P, s \in S, \text{rb}_{\text{matches}_{p, w}, w, s} = t \} \right| = 1.
 \]
\end{enumerate}



\subsubsection{Symmetry Breaking Constraints}

\begin{enumerate}
\item \textbf{Period symmetry:}
Swapping period labels across weeks yields equivalent schedules, i.e rescheduling games already scheduled for period i to period j and those for period j to i results in another valid assignement. To eliminate this redundancy, we enforce a lexicographic ordering:
$$
(\text{matches}_{p, w})_{p \in P, w \in W} \succ_{\text{lex}} (\text{matches}_{p, w})_{\text{reversed}(p) \in P, w \in W}
$$
% Due to the \texttt{all\_different} constraint on $\text{matches}_{p,w}$ per week, this comparison typically resolves early by comparing $\text{matches}_{0,0}$ and $\text{matches}_{|P| - 1,0}$. However, we prefer the full lexicographic constraint over a simple pairwise comparison because it provides stronger constraint propagation improving solver performance overall.

\item \textbf{Fix first match home:} 
Swapping home/away assignments of all matches yields an equivalent optimal solution. To counteract this symmetry, we enforce the following assignment:
\[ \text{flip\_slot}_{0, 0} = 0 \]


\end{enumerate}

\subsection{Validation}

\subsubsection{Experimental Design}

The model was implemented in MiniZinc and validated through a series of experiments designed to assess solver performance under various model configurations and search strategies.

\textbf{Solvers:}
The following solvers were employed: \textit{Gecode 6.3.0}, \textit{Chuffed 0.13.2} and \textit{OR-Tools CP-SAT 9.12.4544}. 
The same time limit of $300$ seconds was imposed for each individual problem instance.

\textbf{Model Configurations:}
Four configurations were tested: \texttt{baseline} (core constraints only), \texttt{baseline+implied}, \texttt{baseline+symmetry breaking}, \texttt{full model}.

\textbf{Search Strategies:}
Three distinct search strategies were employed to analyze solver behavior

\begin{enumerate}
    \item \textbf{Default Search Strategy (Solver's Default):} Each solver relied entirely on its built-in decision heuristics and restart policies, serving as a baseline for their inherent capabilities.

    \item \textbf{Sequential Custom Search Strategy:} A manually defined sequential search \texttt{seq\_search} with \texttt{restart\_luby(100)} policy was applied. 
    Firstly the \texttt{matches} variables  are assigned and secondly the \texttt{flip\_slot} variables. 
    We chose as variable assignment strategies \texttt{dom\_w\_deg} for \texttt{matches} and \texttt{first\_fail} for \texttt{flip\_slot}, while for value assignments we used \\\texttt{indomain\_min} for both.

    \item \textbf{Relax-and-Reconstruct (LNS) Strategy:} This higher-level strategy incorporates \texttt{relax\_and\_reconstruct} on the \texttt{matches} variables (preserving 60\% of solution values), leveraging the Large Neighborhood Search (LNS) technique. It was layered on top of the "Sequential Custom Search Strategy".
\end{enumerate}

\textbf{Solver-Specific Strategy Application:}
To ensure a fair and controlled comparison under single-threaded conditions (aligning with project constraints), OR-Tools CP-SAT was run without multi-threading. For both Chuffed and OR-Tools CP-SAT, the \texttt{free\_search} parameter was explicitly omitted when applying the Sequential Custom Search and Relax-and-Reconstruct strategies. This allowed direct evaluation of the user-defined MiniZinc search annotations, rather than the solvers' embedded heuristics.


\subsubsection{Experimental Results}
In the following tables, we report the objective values found by each solver for the following four model configurations:
\begin{itemize}
    \item \texttt{bs} denotes the baseline model
     \item  \texttt{noIMPL} denotes the baseline with symmetry breaking constraints
    \item \texttt{noSB} denotes the baseline with implied constraints
    \item \texttt{complete} denotes the full model with both implied and symmetry breaking constraints
\end{itemize}

\begin{table}[htbp]
\centering
\small
\resizebox{\textwidth}{!}{%
\begin{tabular}{c|cccc|cccc|cccc}
\toprule
\textbf{n} & \multicolumn{4}{c|}{\textbf{GECODE}} & \multicolumn{4}{c|}{\textbf{CHUFFED}} & \multicolumn{4}{c}{\textbf{CP-SAT}} \\
\cmidrule(lr){2-5}\cmidrule(lr){6-9}\cmidrule(lr){10-13}
  & bs & complete & noIMPL & noSB & bs & complete & noIMPL & noSB & bs & complete & noIMPL & noSB \\
\midrule
6 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
8 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
10 & 9 & 3 & 3 & 5 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
12 & 11 & 3 & 3 & 3 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
14 & 13 & 5 & 5 & 5 & N/A & N/A & 4 & N/A & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
16 & 15 & N/A & N/A & 5 & N/A & N/A & N/A & N/A & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
18 & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
20 & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
22 & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & \textbf{1} & \textbf{1} & \textbf{1} \\
\bottomrule
\end{tabular}%
}
\caption{Objective values using \textit{Default Search Strategy (Solver's Default)}}
\label{cp1-result}
\end{table}



\begin{table}[htbp]
\centering
\small
\resizebox{\textwidth}{!}{%
\begin{tabular}{c|cccc|cccc|cccc}
\toprule
\textbf{n} & \multicolumn{4}{c|}{\textbf{GECODE}} & \multicolumn{4}{c|}{\textbf{CHUFFED}} & \multicolumn{4}{c}{\textbf{CP-SAT}} \\
\cmidrule(lr){2-5}\cmidrule(lr){6-9}\cmidrule(lr){10-13}
  & bs & complete & noIMPL & noSB & bs & complete & noIMPL & noSB & bs & complete & noIMPL & noSB \\
\midrule
6 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
8 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
10 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
12 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
14 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & N/A & \textbf{1} & \textbf{1} & N/A & N/A & N/A & N/A & N/A \\
16 & 15 & 3 & \textbf{1} & \textbf{1} & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A \\
18 & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A \\
20 & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A \\
22 & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A \\
\bottomrule
\end{tabular}%
}
\caption{Objective values using \textit{Sequential Custom Search Strategy}}
\label{cp2-result}
\end{table}

\begin{table}[htbp]
\centering
\small
\resizebox{\textwidth}{!}{%
\begin{tabular}{c|cccc|cccc|cccc}
\toprule
\textbf{n} & \multicolumn{4}{c|}{\textbf{GECODE}} & \multicolumn{4}{c|}{\textbf{CHUFFED}} & \multicolumn{4}{c}{\textbf{CP-SAT}} \\
\cmidrule(lr){2-5}\cmidrule(lr){6-9}\cmidrule(lr){10-13}
  & bs & complete & noIMPL & noSB & bs & complete & noIMPL & noSB & bs & complete & noIMPL & noSB \\
\midrule
6 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
8 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
10 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
12 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} \\
14 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & N/A & N/A & \textbf{1} & N/A & N/A & N/A & N/A & N/A \\
16 & \textbf{1} & \textbf{1} & \textbf{1} & \textbf{1} & N/A & N/A & 13 & N/A & N/A & N/A & N/A & N/A \\
18 & N/A & \textbf{1} & N/A & \textbf{1} & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A \\
20 & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A \\
22 & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A & N/A \\
\bottomrule
\end{tabular}%
}
\caption{Objective values using \textit{Relax-and-Reconstruct (LNS) Strategy}}
\label{cp3-result}
\end{table}

The experimental results, Tables~\ref{cp1-result}~\ref{cp2-result}~\ref{cp3-result}, show that the \texttt{CP-SAT} solver, with its default search strategy, consistently delivers the best performance. 
Moreover, combining Sequential Search with the Relax-and-Reconstruct (LNS) strategy improves \texttt{Gecode} by solving larger instances and finding valid or optimal solutions where the default did not succeed.

\newpage